{"ast":null,"code":"import axios from 'axios';\nimport jwt_decode from \"jwt-decode\";\nimport dayjs from \"dayjs\";\nconst axiosInstance = axios.create({\n  baseURL: 'http://localhost:8080/',\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json',\n    Accept: 'application/json'\n  }\n});\naxiosInstance.interceptors.request.use(async config => {\n  const accessToken = localStorage.getItem('access_token');\n  if (accessToken) {\n    const unixNow = dayjs().unix();\n    // check if access token is expired\n    if (unixNow >= jwt_decode(accessToken).exp) {\n      const refreshToken = localStorage.getItem('refresh_token');\n      // check if refresh token is expired\n      if (unixNow >= jwt_decode(refreshToken).exp) {\n        logout();\n      } else {\n        // refresh access token\n        try {\n          const {\n            data\n          } = await axios.post(`${baseURL}api/token/refresh/`, {\n            refresh: refreshToken\n          });\n          localStorage.setItem('access_token', data.access);\n          localStorage.setItem('refresh_token', data.refresh);\n        } catch (error) {\n          logout();\n        }\n      }\n    }\n    config.headers.Authorization = `Bearer ${localStorage.getItem('access_token')}`;\n  }\n  return config;\n});\nexport default axiosInstance;","map":{"version":3,"names":["axios","jwt_decode","dayjs","axiosInstance","create","baseURL","timeout","headers","Accept","interceptors","request","use","config","accessToken","localStorage","getItem","unixNow","unix","exp","refreshToken","logout","data","post","refresh","setItem","access","error","Authorization"],"sources":["C:/Users/hp/ReactProjects/restaurants/src/components/axiosInstance.js"],"sourcesContent":["import axios from 'axios';\r\nimport jwt_decode from \"jwt-decode\";\r\nimport dayjs from \"dayjs\";\r\n\r\n\r\n\r\nconst axiosInstance = axios.create({\r\n    baseURL: 'http://localhost:8080/',\r\n    timeout: 10000,\r\n    headers: {\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n    }\r\n});\r\naxiosInstance.interceptors.request.use(async (config) => {\r\n    const accessToken = localStorage.getItem('access_token');\r\n    if (accessToken) {\r\n        const unixNow = dayjs().unix();\r\n        // check if access token is expired\r\n        if (unixNow >= jwt_decode(accessToken).exp) {\r\n            const refreshToken = localStorage.getItem('refresh_token');\r\n            // check if refresh token is expired\r\n            if (unixNow >= jwt_decode(refreshToken).exp) {\r\n                logout();\r\n            } else {\r\n                // refresh access token\r\n                try {\r\n                    const {data} = await axios.post(`${baseURL}api/token/refresh/`, {\r\n                        refresh: refreshToken,\r\n                    });\r\n                    localStorage.setItem('access_token', data.access);\r\n                    localStorage.setItem('refresh_token', data.refresh);\r\n                } catch (error) {\r\n                    logout();\r\n                }\r\n            }\r\n        }\r\n        config.headers.Authorization = `Bearer ${localStorage.getItem('access_token')}`;\r\n    }\r\n    return config;\r\n});\r\n\r\n\r\n\r\n\r\nexport default axiosInstance;"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,OAAOC,UAAU,MAAM,YAAY;AACnC,OAAOC,KAAK,MAAM,OAAO;AAIzB,MAAMC,aAAa,GAAGH,KAAK,CAACI,MAAM,CAAC;EAC/BC,OAAO,EAAE,wBAAwB;EACjCC,OAAO,EAAE,KAAK;EACdC,OAAO,EAAE;IACL,cAAc,EAAE,kBAAkB;IAClCC,MAAM,EAAE;EACZ;AACJ,CAAC,CAAC;AACFL,aAAa,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,CAAC,MAAOC,MAAM,IAAK;EACrD,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;EACxD,IAAIF,WAAW,EAAE;IACb,MAAMG,OAAO,GAAGd,KAAK,EAAE,CAACe,IAAI,EAAE;IAC9B;IACA,IAAID,OAAO,IAAIf,UAAU,CAACY,WAAW,CAAC,CAACK,GAAG,EAAE;MACxC,MAAMC,YAAY,GAAGL,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;MAC1D;MACA,IAAIC,OAAO,IAAIf,UAAU,CAACkB,YAAY,CAAC,CAACD,GAAG,EAAE;QACzCE,MAAM,EAAE;MACZ,CAAC,MAAM;QACH;QACA,IAAI;UACA,MAAM;YAACC;UAAI,CAAC,GAAG,MAAMrB,KAAK,CAACsB,IAAI,CAAE,GAAEjB,OAAQ,oBAAmB,EAAE;YAC5DkB,OAAO,EAAEJ;UACb,CAAC,CAAC;UACFL,YAAY,CAACU,OAAO,CAAC,cAAc,EAAEH,IAAI,CAACI,MAAM,CAAC;UACjDX,YAAY,CAACU,OAAO,CAAC,eAAe,EAAEH,IAAI,CAACE,OAAO,CAAC;QACvD,CAAC,CAAC,OAAOG,KAAK,EAAE;UACZN,MAAM,EAAE;QACZ;MACJ;IACJ;IACAR,MAAM,CAACL,OAAO,CAACoB,aAAa,GAAI,UAASb,YAAY,CAACC,OAAO,CAAC,cAAc,CAAE,EAAC;EACnF;EACA,OAAOH,MAAM;AACjB,CAAC,CAAC;AAKF,eAAeT,aAAa"},"metadata":{},"sourceType":"module","externalDependencies":[]}